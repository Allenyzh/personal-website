---
import BaseLayout from "@/layouts/BaseLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ArrowLeft, Clock } from "@lucide/astro";

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  author: string;
  tech?: string[];
  prevItem: { title: string; slug: string };
  nextItem: { title: string; slug: string };
  collectionType: "blog" | "projects";
  readingTime?: string;
}

const {
  title,
  description,
  pubDate,
  author,
  tech,
  prevItem,
  nextItem,
  collectionType,
  readingTime,
} = Astro.props;
---

<style is:inline>
  .prose blockquote > * {
    font-size: 0.85rem; /* text-xs */
    line-height: normal;
    color: #a0a0a0; /* text-gray-600 */
    font-style: italic;
    font-weight: 600;
  }
</style>

<BaseLayout
  title={`${collectionType === "blog" ? "Blog" : "Project"} - ${title}`}
  specialDescription={description}
>
  <div class="md:mx-auto max-w-7xl space-y-3 px-5">
    <a href={`/${collectionType}`}>
      <Button className="mt-4 group cursor-pointer" variant="outline" size="sm">
        <ArrowLeft
          class="h-4 w-4 group-hover:-translate-x-1 transition-all duration-200"
        />
        <span class="translate-y-[1.25px]">
          Back to {collectionType === "blog" ? "blogs" : "projects"}
        </span>
      </Button>
    </a>

    <h1 class="text-center text-4xl font-bold mt-6">{title}</h1>

    <div class="flex justify-center items-center gap-3 flex-wrap">
      <span class="text-sm text-muted-foreground">
        <FormattedDate date={pubDate} />
      </span>
      <span class="text-sm text-muted-foreground capitalize border-l pl-3">
        By {author}
      </span>
      {
        readingTime && (
          <span class="text-sm text-muted-foreground border-l pl-3 flex items-center gap-1">
            <Clock class="h-3.5 w-3.5 -translate-y-[1.25px]" />
            <span>{readingTime}</span>
          </span>
        )
      }
    </div>

    <p class="text-center text-muted-foreground">
      {description}
    </p>

    <!-- Tech Stack (只在 projects 中显示) -->
    {
      tech && tech.length > 0 && (
        <div class="flex justify-center">
          <div class="flex flex-wrap gap-2 justify-center">
            {tech.map((techItem) => (
              <Badge variant="secondary" className="text-sm">
                {techItem}
              </Badge>
            ))}
          </div>
        </div>
      )
    }

    <div class="flex justify-center gap-4 pb-3 border-b"></div>

    <div
      class="prose prose-headings:text-article-primary prose-p:text-base/8 prose-p:tracking-wide prose-figcaption:text-xs prose-img:min-w-2xs prose-img:max-w-[21rem] prose-img:xs:min-w-xs prose-img:xs:max-w-sm prose-img:sm:min-w-sm prose-img:sm:max-w-lg prose-img:md:min-w-lg prose-img:md:max-w-3xl prose-h4:mb-12 max-w-none prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:text-gray-800 prose-pre:indent-0 prose-code:not-[pre>code]:bg-gray-200 prose-code:not-[pre>code]:px-2 prose-code:not-[pre>code]:py-1 prose-code:not-[pre>code]:mr-1 prose-code:not-[pre>code]:before:content-[''] prose-code:not-[pre>code]:after:content-[''] prose-code:not-[pre>code]:hover:bg-gray-300 prose-code:not-[pre>code]:transition-all prose-code:not-[pre>code]:duration-200 prose-code:not-[pre>code]:hover:cursor-default"
    >
      <slot />
    </div>

    <!-- Navigation Buttons -->
    <div class="mt-12 py-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Previous Button -->
        <a
          href={`/${collectionType}/${prevItem.slug}`}
          class="group flex flex-col p-4 rounded-lg border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all duration-200"
        >
          <span class="text-sm text-muted-foreground mb-1">PREV</span>
          <span class="font-medium text-lg transition-colors">
            {prevItem.title}
          </span>
        </a>

        <!-- Next Button -->
        <a
          href={`/${collectionType}/${nextItem.slug}`}
          class="group flex flex-col p-4 rounded-lg border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all duration-200 text-right"
        >
          <span class="text-sm text-muted-foreground mb-1">NEXT</span>
          <span class="font-medium text-lg transition-colors">
            {nextItem.title}
          </span>
        </a>
      </div>
    </div>
  </div>
</BaseLayout>
